import React, { useState, useEffect, useRef } from 'react'; import { MessageCircle, X, Send, Minimize2, Maximize2, Bot, Sparkles, CheckCircle } from 'lucide-react'; // Mock VIP Booking Assistant for demo purposes class MockVIPBookingAssistant { constructor(sessionId) { this.sessionId = sessionId; this.extractedData = {}; } async processMessage(message) { await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1200)); const lowerMessage = message.toLowerCase(); let response = "I understand you're interested in our VIP transport services. "; if (lowerMessage.includes('airport')) { response += "Our airport transfer service ensures punctual, comfortable journeys. What's your preferred pickup location and travel date?"; } else if (lowerMessage.includes('wedding')) { response += "Congratulations! We'll make your special day even more memorable with our luxury wedding transport. When is your wedding date?"; } else if (lowerMessage.includes('corporate')) { response += "Our corporate transport service provides professional, reliable travel solutions. What type of corporate event or meeting do you need transport for?"; } else { response += "I'd be happy to help arrange your luxury transport. Could you tell me more about your travel needs?"; } if (lowerMessage.includes('john') || lowerMessage.includes('name')) { this.extractedData.customer_name = 'John'; } if (lowerMessage.includes('@') || lowerMessage.includes('email')) { this.extractedData.customer_email = 'customer@example.com'; } return { response, bookingReady: Object.keys(this.extractedData).length > 3 }; } getExtractedData() { return this.extractedData; } async submitBooking() { return { success: true, bookingId: 'VIP-' + Date.now() }; } } const AIBookingAssistant = ({ isVisible = true, position = 'bottom-left' }) => { const [isOpen, setIsOpen] = useState(false); const [isMinimized, setIsMinimized] = useState(false); const [messages, setMessages] = useState([]); const [inputMessage, setInputMessage] = useState(''); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(null); const [sessionId] = useState(() => session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}); const [bookingSubmitted, setBookingSubmitted] = useState(false); const [isTyping, setIsTyping] = useState(false); const [showProgress, setShowProgress] = useState(false); const [completedFields, setCompletedFields] = useState([]); const [isMobile, setIsMobile] = useState(false); const messagesEndRef = useRef(null); const assistantRef = useRef(null); const inputRef = useRef(null); // Check if mobile useEffect(() => { const checkMobile = () => { setIsMobile(window.innerWidth < 640); }; checkMobile(); window.addEventListener('resize', checkMobile); return () => window.removeEventListener('resize', checkMobile); }, []); // Initialize the assistant useEffect(() => { if (!assistantRef.current) { assistantRef.current = new MockVIPBookingAssistant(sessionId); } }, [sessionId]); // Scroll to bottom when messages change useEffect(() => { scrollToBottom(); }, [messages]); // Focus input when opened useEffect(() => { if (isOpen && !isMinimized && inputRef.current && !isMobile) { setTimeout(() => { if (inputRef.current) { inputRef.current.focus(); } }, 100); } }, [isOpen, isMinimized, isMobile]); // Show welcome message when opened useEffect(() => { if (isOpen && messages.length === 0) { setIsTyping(true); setTimeout(() => { setIsTyping(false); const welcomeMessage = { role: 'assistant', content: "Hello! I'm Alex, your VIP transport specialist. I'm here to arrange luxury transport that exceeds your expectations.\n\nWhether you need airport transfers, wedding transport, corporate travel, or our exclusive security services - I'll make it seamless for you.\n\nWhat's your name? I'd love to provide you with personalized service.", timestamp: new Date() }; setMessages([welcomeMessage]); setShowProgress(true); }, 1200); } }, [isOpen, messages.length]); // Update progress tracking useEffect(() => { if (assistantRef.current) { try { const extractedData = assistantRef.current.getExtractedData(); const completed = []; if (extractedData.customer_name) completed.push('name'); if (extractedData.customer_email) completed.push('email'); if (extractedData.customer_phone) completed.push('phone'); if (extractedData.service_type) completed.push('service'); if (extractedData.pickup_location) completed.push('pickup'); if (extractedData.dropoff_location) completed.push('destination'); if (extractedData.booking_date) completed.push('date'); if (extractedData.booking_time) completed.push('time'); if (extractedData.passenger_count) completed.push('passengers'); if (extractedData.vehicle_preference) completed.push('vehicle'); if (extractedData.special_requirements) completed.push('requirements'); setCompletedFields(completed); } catch (error) { console.error('Error updating progress:', error); } } }, [messages]); const scrollToBottom = () => { if (messagesEndRef.current) { messagesEndRef.current.scrollIntoView({ behavior: 'smooth' }); } }; const simulateTyping = (callback, delay = 1000) => { setIsTyping(true); setTimeout(() => { setIsTyping(false); callback(); }, delay); }; const getTypingDelay = (messageLength) => { const baseDelay = 800; const lengthFactor = Math.min(messageLength * 20, 2000); return baseDelay + lengthFactor + Math.random() * 500; }; const handleSendMessage = async () => { if (!inputMessage.trim() || isLoading || !assistantRef.current) return; const userMessage = { role: 'user', content: inputMessage, timestamp: new Date() }; setMessages(prev => [...prev, userMessage]); const currentInput = inputMessage; setInputMessage(''); setIsLoading(true); setError(null); try { const typingDelay = getTypingDelay(currentInput.length); simulateTyping(async () => { try { const result = await assistantRef.current.processMessage(currentInput); const assistantMessage = { role: 'assistant', content: result.response, timestamp: new Date() }; setMessages(prev => [...prev, assistantMessage]); if (result.bookingReady && !bookingSubmitted) { setBookingSubmitted(true); try { const booking = await assistantRef.current.submitBooking(); setTimeout(() => { const confirmationMessage = { role: 'assistant', content: ğŸ‰ Wonderful! Your booking request has been submitted successfully!\n\nHere's what happens next:\nâ€¢ Our team will review your request within 30 minutes\nâ€¢ You'll receive a confirmation call or email\nâ€¢ We'll coordinate all journey details with you\n\nğŸ“ **For immediate assistance:** 07464 247 007\nğŸ“§ **Email:** bookings@viptransportandsecurity.co.uk\n\nThank you for choosing VIP Transport and Security! Is there anything else I can help you with today?, timestamp: new Date() }; setMessages(prev => [...prev, confirmationMessage]); setShowProgress(false); }, 1000); } catch (bookingError) { setTimeout(() => { const successMessage = { role: 'assistant', content: Your booking details have been received successfully! ğŸ‰\n\nOur team has all your information and will contact you within 30 minutes to confirm your booking.\n\nğŸ“ **For immediate assistance:** 07464 247 007\nğŸ“§ **Email:** bookings@viptransportandsecurity.co.uk\n\nThank you for choosing VIP Transport and Security!, timestamp: new Date() }; setMessages(prev => [...prev, successMessage]); setShowProgress(false); }, 1000); } } setIsLoading(false); } catch (innerError) { setIsLoading(false); setIsTyping(false); throw innerError; } }, typingDelay); } catch (error) { setError('Connection issue - let me try again.'); const errorMessage = { role: 'assistant', content: "I apologize for the brief connection issue. I'm here and ready to help you with your VIP transport booking. Could you please repeat your last message?", timestamp: new Date() }; setMessages(prev => [...prev, errorMessage]); setIsLoading(false); setIsTyping(false); } }; const handleKeyPress = (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } }; const getProgressPercentage = () => { const totalFields = 11; return Math.round((completedFields.length / totalFields) * 100); }; const formatMessageContent = (content) => { const parts = content.split('\n'); return ( <div className="space-y-1.5"> {parts.map((part, index) => { if (part.trim() === '') return null; if (part.startsWith('ğŸ“') || part.startsWith('ğŸ“§')) { return ( <div key={index} className="bg-blue-50 p-2 rounded text-xs sm:text-sm text-blue-800 mt-1"> {part} </div> ); } else if (part.includes('**') && part.includes('**')) { const boldParts = part.split(/(\*\*[^*]+\*\*)/); return ( <div key={index} className="text-xs sm:text-sm"> {boldParts.map((boldPart, boldIndex) => { if (boldPart.startsWith('**') && boldPart.endsWith('**')) { return <strong key={boldIndex} className="font-semibold">{boldPart.slice(2, -2)}</strong>; } return boldPart; })} </div> ); } else if (part.startsWith('â€¢') || part.startsWith('ğŸš—') || part.startsWith('âœˆï¸') || part.startsWith('ğŸ’’') || part.startsWith('ğŸ’¼') || part.startsWith('ğŸ­') || part.startsWith('ğŸ›¡ï¸')) { return ( <div key={index} className="flex items-start space-x-2 ml-2"> <span className="text-blue-500 mt-0.5 flex-shrink-0 text-xs sm:text-sm"> {part.startsWith('â€¢') ? 'â€¢' : part.charAt(0)} </span> <span className="text-xs sm:text-sm">{part.slice(part.startsWith('â€¢') ? 1 : 2).trim()}</span> </div> ); } else { return <div key={index} className="text-xs sm:text-sm">{part}</div>; } })} </div> ); }; const handleQuickAction = (option) => { setInputMessage(option); setTimeout(() => { handleSendMessage(); }, 100); }; if (!isVisible) return null; // Mobile full-screen chat if (isMobile && isOpen) { return ( <div className="fixed inset-0 z-50 bg-white flex flex-col"> {/* Mobile Header */} <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 flex items-center justify-between shadow-md"> <div className="flex items-center space-x-3"> <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center"> <Bot className="w-5 h-5 text-blue-500" /> </div> <div> <h3 className="font-semibold text-sm">Alex - VIP Transport AI</h3> <p className="text-xs opacity-90 flex items-center"> <Sparkles className="w-3 h-3 mr-1" /> Intelligent Booking Assistant </p> </div> </div> <button onClick={() => setIsOpen(false)} className="hover:bg-white/10 p-2 rounded transition-colors" aria-label="Close" > <X className="w-5 h-5" /> </button> </div> {/* Progress on mobile */} {showProgress && completedFields.length > 0 && ( <div className="bg-green-50 border-b border-green-200 p-3"> <div className="flex items-center justify-between text-green-700 text-sm"> <div className="flex items-center space-x-2"> <CheckCircle className="w-4 h-4" /> <span>Progress: {completedFields.length}/11 details</span> </div> <div className="flex items-center space-x-2"> <span className="text-xs">{getProgressPercentage()}%</span> <div className="w-16 h-2 bg-green-200 rounded-full overflow-hidden"> <div className="h-full bg-green-500 transition-all duration-500" style={{ width: ${getProgressPercentage()}% }} /> </div> </div> </div> </div> )} {/* Error display */} {error && ( <div className="bg-red-100 text-red-800 p-3 text-sm mx-4 mt-2 rounded-md flex items-center space-x-2"> <X className="w-4 h-4" /> <span className="flex-1">{error}</span> <button onClick={() => setError(null)} className="text-red-600 hover:text-red-800" > Ã— </button> </div> )} {/* Messages - Mobile */} <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50"> {messages.map((message, index) => ( <div key={message-${index}} className={flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}} > <div className={max-w-[90%] px-3 py-2 rounded-2xl shadow-sm ${ message.role === 'user' ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-br-md' : 'bg-white text-gray-800 border border-gray-200 rounded-bl-md' }} > <div className="leading-relaxed"> {formatMessageContent(message.content)} </div> <p className={text-xs mt-2 ${message.role === 'user' ? 'text-blue-100' : 'text-gray-500'}}> {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} </p> </div> </div> ))} {/* Typing indicator - Mobile */} {(isLoading || isTyping) && ( <div className="flex justify-start"> <div className="bg-white px-4 py-3 rounded-2xl rounded-bl-md shadow-sm border border-gray-200 flex items-center space-x-3"> <div className="w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center"> <Bot className="w-4 h-4 text-blue-500" /> </div> <div className="flex space-x-1"> <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div> <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div> <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div> </div> <span className="text-xs text-gray-500">Thinking...</span> </div> </div> )} <div ref={messagesEndRef} /> </div> {/* Input area - Mobile */} <div className="border-t border-gray-200 p-4 bg-white"> <div className="flex space-x-3"> <input ref={inputRef} type="text" value={inputMessage} onChange={(e) => setInputMessage(e.target.value)} onKeyPress={handleKeyPress} placeholder="Type your message..." className="flex-1 px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-sm transition-all duration-200" disabled={isLoading || isTyping} /> <button onClick={handleSendMessage} disabled={isLoading || isTyping || !inputMessage.trim()} className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-3 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" > <Send className="w-5 h-5" /> </button> </div> {/* Quick action buttons - Mobile */} {messages.length <= 1 && ( <div className="flex flex-wrap gap-2 mt-3"> {['Airport Transfer', 'Wedding Transport', 'Corporate Travel'].map((option) => ( <button key={option} onClick={() => handleQuickAction(option)} className="px-3 py-1.5 text-sm bg-gray-100 hover:bg-blue-100 text-gray-700 hover:text-blue-700 rounded-full transition-colors duration-200" disabled={isLoading || isTyping} > {option} </button> ))} </div> )} {/* Footer - Mobile */} <div className="flex flex-col items-center mt-3 text-xs text-gray-500 space-y-1"> <div className="flex items-center space-x-2"> <Sparkles className="w-3 h-3" /> <span>AI-Powered â€¢ Secure â€¢ Professional</span> </div> <div className="flex items-center space-x-1"> <span>Made by</span> <a href="https://marknova.vercel.app/" target="_blank" rel="noopener noreferrer" className="hover:underline text-blue-600 font-medium" > MarkNova </a> </div> </div> </div> </div> ); } const positionClasses = { 'bottom-right': 'right-4 sm:right-6', 'bottom-left': 'left-4 sm:left-6' }; return ( <> {/* Floating Button */} {!isOpen && ( <div className={fixed bottom-4 sm:bottom-6 ${positionClasses[position]} z-50}> <button onClick={() => setIsOpen(true)} className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-3 sm:p-4 rounded-full shadow-2xl transition-all duration-300 hover:scale-110 group relative" aria-label="Open VIP booking assistant" > <MessageCircle className="w-6 h-6" /> <div className="absolute -top-1 -right-1 bg-yellow-400 text-black text-xs rounded-full w-6 h-6 sm:w-7 sm:h-7 flex items-center justify-center animate-pulse font-bold"> <Sparkles className="w-3 h-3" /> </div> <div className="absolute -bottom-12 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-3 py-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap hidden sm:block"> Chat with Alex - VIP Transport AI </div> </button> </div> )} {/* Desktop Chat Window */} {isOpen && !isMobile && ( <div className={fixed bottom-4 sm:bottom-6 ${positionClasses[position]} z-50 bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden transition-all duration-300} style={{ width: '400px', height: isMinimized ? '60px' : '540px' }} > {/* Header */} <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 flex items-center justify-between"> <div className="flex items-center space-x-3"> <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-inner"> <Bot className="w-5 h-5 text-blue-500" /> </div> <div> <h3 className="font-semibold text-sm">Alex - VIP Transport AI</h3> <p className="text-xs opacity-90 flex items-center"> <Sparkles className="w-3 h-3 mr-1" /> Intelligent Booking Assistant </p> </div> </div> <div className="flex items-center space-x-2"> {showProgress && ( <div className="flex items-center space-x-2 mr-2"> <div className="text-xs opacity-90">{getProgressPercentage()}%</div> <div className="w-8 h-2 bg-white/20 rounded-full overflow-hidden"> <div className="h-full bg-yellow-400 transition-all duration-500" style={{ width: ${getProgressPercentage()}% }} /> </div> </div> )} <button onClick={() => setIsMinimized(!isMinimized)} className="hover:bg-white/10 p-1.5 rounded transition-colors" aria-label={isMinimized ? 'Maximize' : 'Minimize'} > {isMinimized ? <Maximize2 className="w-4 h-4" /> : <Minimize2 className="w-4 h-4" />} </button> <button onClick={() => setIsOpen(false)} className="hover:bg-white/10 p-1.5 rounded transition-colors" aria-label="Close" > <X className="w-4 h-4" /> </button> </div> </div> {!isMinimized && ( <> {/* Progress indicators */} {showProgress && completedFields.length > 0 && ( <div className="bg-green-50 border-b border-green-200 p-3"> <div className="flex items-center space-x-2 text-green-700 text-sm"> <CheckCircle className="w-4 h-4" /> <span>Progress: {completedFields.length}/11 details collected</span> </div> </div> )} {/* Error display */} {error && ( <div className="bg-red-100 text-red-800 p-3 text-sm mx-4 mt-2 rounded-md flex items-center space-x-2"> <X className="w-4 h-4" /> <span>{error}</span> <button onClick={() => setError(null)} className="ml-auto text-red-600 hover:text-red-800" > Ã— </button> </div> )} {/* Messages */} <div className="h-80 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50 to-white"> {messages.map((message, index) => ( <div key={message-${index}} className={flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}} > <div className={max-w-xs px-4 py-3 rounded-2xl shadow-sm ${ message.role === 'user' ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-br-md' : 'bg-white text-gray-800 border border-gray-200 rounded-bl-md' }} > <div className="leading-relaxed"> {formatMessageContent(message.content)} </div> <p className={text-xs mt-2 ${message.role === 'user' ? 'text-blue-100' : 'text-gray-500'}}> {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} </p> </div> </div> ))} {/* Typing indicator */} {(isLoading || isTyping) && ( <div className="flex justify-start"> <div className="bg-white px-4 py-3 rounded-2xl rounded-bl-md shadow-sm border border-gray-200 flex items-center space-x-3"> <div className="w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center"> <Bot className="w-4 h-4 text-blue-500" /> </div> <div className="flex space-x-1"> <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div> <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div> <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.4s' }}></div> </div> <span className="text-xs text-gray-500">Alex is thinking...</span> </div> </div> )} <div ref={messagesEndRef} /> </div> {/* Input area */} <div className="border-t border-gray-200 p-4 bg-white"> <div className="flex space-x-3"> <div className="flex-1 relative"> <input ref={inputRef} type="text" value={inputMessage} onChange={(e) => setInputMessage(e.target.value)} onKeyPress={handleKeyPress} placeholder="Type your message..." className="w-full px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-sm transition-all duration-200 pr-12" disabled={isLoading || isTyping} /> <div className="absolute right-2 top-1/2 transform -translate-y-1/2"> {inputMessage.trim() && !isLoading && !isTyping && ( <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center"> <Send className="w-4 h-4 text-white" /> </div> )} </div> </div> <button onClick={handleSendMessage} disabled={isLoading || isTyping || !inputMessage.trim()} className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-3 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:scale-105" > <Send className="w-5 h-5" /> </button> </div> {/* Quick action buttons */} {messages.length <= 1 && ( <div className="flex flex-wrap gap-2 mt-3"> {['Airport Transfer', 'Wedding Transport', 'Corporate Travel'].map((option) => ( <button key={option} onClick={() => handleQuickAction(option)} className="px-3 py-1.5 text-xs bg-gray-100 hover:bg-blue-100 text-gray-700 hover:text-blue-700 rounded-full transition-colors duration-200" disabled={isLoading || isTyping} > {option} </button> ))} </div> )} {/* Footer */} <div className="flex flex-col sm:flex-row justify-between items-center mt-3 text-xs text-gray-500 space-y-1 sm:space-y-0"> <div className="flex items-center space-x-2"> <Sparkles className="w-3 h-3" /> <span>AI-Powered â€¢ Secure â€¢ Professional</span> </div> <div className="flex items-center space-x-1"> <span>Made by</span> <a href="https://marknova.vercel.app/" target="_blank" rel="noopener noreferrer" className="hover:underline text-blue-600 font-medium" > MarkNova </a> </div> </div> </div> </> )} </div> )} {/* Backdrop for desktop when needed */} {isOpen && !isMobile && ( <div className="fixed inset-0 bg-black bg-opacity-10 z-40 hidden sm:block" onClick={() => setIsOpen(false)} /> )} </> ); }; export default AIBookingAssistant;
